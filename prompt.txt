  # Create macox: A Safe Rust Library for macOS UI

  ## Context
  I have a working Rust project (`pthkd`) at `/Users/tfarrell/dev/pthkd` that contains a `src/macos/` module with macOS UI functionality. I want to extract this into a standalone library called **macox** (macOS + Rust/OX) that can be reused in future projects.

  ## Current State
  The `pthkd/src/macos/` module contains:
  - **Working code**: Event tap, notifications, dialogs, windows, menubar
  - **Architecture**: FFI layer â†’ RAII wrappers â†’ MacOSSession singleton â†’ Feature modules
  - **Problem**: Everything requires `unsafe` blocks, not well-organized for library use

  ## Goal
  Create a new crate at `~/dev/macox` with:
  1. **Rust 2024 edition**
  2. **Safe public API** - users never write `unsafe`
  3. **Clear module organization**:
     - `ffi/` - Private FFI bindings
     - `sys/` - Private RAII wrappers
     - `session.rs` - Internal session management
     - Public modules: `dialogs`, `notifications`, `events`, `windows`, `menubar`
  4. **Builder pattern** for ergonomic APIs (e.g., `Alert::new("Title").message("Text").show()`)

  ## Architecture Design
  macox/
  â”œâ”€â”€ src/
  â”‚   â”œâ”€â”€ lib.rs              // Public API
  â”‚   â”œâ”€â”€ ffi/                // ðŸ”’ Private FFI
  â”‚   â”œâ”€â”€ sys/                // ðŸ”’ Private RAII wrappers
  â”‚   â”œâ”€â”€ session.rs          // ðŸ”’ Internal MacOSSession
  â”‚   â”œâ”€â”€ dialogs.rs          // âœ… Public safe API
  â”‚   â”œâ”€â”€ notifications.rs    // âœ… Public safe API
  â”‚   â””â”€â”€ events/             // âœ… Public safe API
  â”‚       â”œâ”€â”€ mod.rs
  â”‚       â”œâ”€â”€ keyboard.rs
  â”‚       â””â”€â”€ permissions.rs
  â””â”€â”€ examples/
      â”œâ”€â”€ hello_notification.rs
      â””â”€â”€ alert_dialog.rs

  ## Key Design Patterns
  1. **Safe wrappers hide unsafe**: Builder pattern (Alert, Notification, etc.)
  2. **GCD dispatch for modals**: `Alert::show_async()` uses `dispatch_to_main_queue()`
  3. **RAII for memory safety**: CFString, AXElement auto-release via Drop

  ## Request
  Please create a comprehensive plan for:
  1. Setting up the new `macox` crate structure at `~/dev/macox`
  2. Migrating core code from `pthkd/src/macos/` to `macox/src/`
  3. Creating safe public APIs (start with dialogs + notifications)
  4. Adding example programs to validate it works
  5. Document how to migrate pthkd to use macox as a dependency

  **Important**: Create a detailed plan FIRST before implementing, as we may need to pause/resume. Include specific file paths and code structure.

  Source material to reference: `/Users/tfarrell/dev/pthkd/src/macos/`

  Start by exploring the existing macos module to understand the current architecture, then create the plan.

  This gives the fresh session everything it needs to pick up where we left off!
